<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏ß‡∏£ OPD ENT</title>
  <p class="text-center" style="color: red; font-weight: bold;">
      ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07.00 - 23.59 ‡∏ô.</p>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Noto Sans Thai -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet" />
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      font-family: "Noto Sans Thai", sans-serif;
      background-image: url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1950&q=80");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .overlay {
      background-color: rgba(255, 255, 255, 0.92);
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      max-width: 600px;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <h2 class="text-center mb-4">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏ß‡∏£ OPD ENT</h2>
    <form id="shiftForm">
      <input type="hidden" name="id" id="idField" />

      <div class="mb-3">
        <label for="name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input type="text" class="form-control" name="name" required />
      </div>

      <div class="mb-3">
        <label for="booking" class="form-label">‡∏à‡∏≠‡∏á</label>
        <select class="form-select" name="booking" required>
          <option value="" disabled selected>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
          <option value="off OT">off OT</option>
          <option value="off DO">off DO</option>
          <option value="off OT+DO">off OT+DO</option>
          <option value="Vacation ‡πÄ‡∏ä‡πâ‡∏≤">Vacation ‡πÄ‡∏ä‡πâ‡∏≤</option>
          <option value="Vacation ‡∏ö‡πà‡∏≤‡∏¢">Vacation ‡∏ö‡πà‡∏≤‡∏¢</option>
          <option value="Vacation ‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô">Vacation ‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô</option>
          <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
          <option value="‡πÄ‡∏ß‡∏£ M">‡πÄ‡∏ß‡∏£ M</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" class="form-control" name="date" id="dateInput" required />
      </div>

      <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏ô -->
      <input type="hidden" name="time" id="timeInput" />

      <button type="submit" class="btn btn-primary w-100" id="submitBtn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>
  </div>

  <script>
  const dateInput = document.getElementById("dateInput");
  const timeInput = document.getElementById("timeInput");
  const idField = document.getElementById("idField");
  const submitBtn = document.getElementById("submitBtn");

  // ‚úÖ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ß‡∏±‡∏ô: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡∏≠‡∏µ‡∏Å 2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ä‡∏ô‡∏ß‡∏±‡∏ô
  const today = new Date();
  const todayStr = today.toISOString().split("T")[0];
  dateInput.setAttribute("min", todayStr);

  const maxDate = new Date(today);
  maxDate.setMonth(maxDate.getMonth() + 2);

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á maxDate ‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏£‡∏ì‡∏µ 31 ‡∏°‡∏µ.‡∏Ñ. ‚Üí ‡∏û.‡∏Ñ. ‡∏°‡∏µ 30 ‡∏ß‡∏±‡∏ô)
  if (maxDate.getDate() !== today.getDate()) {
    maxDate.setDate(0); // ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
  }

  const maxStr = maxDate.toISOString().split("T")[0];
  dateInput.setAttribute("max", maxStr);

    function setCurrentTime() {
      timeInput.value = "00:00"; // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô 00:00 ‡πÄ‡∏™‡∏°‡∏≠
    }

    function getNextID() {
      let lastId = localStorage.getItem("lastFormId");
      if (!lastId) lastId = 0;
      const nextId = parseInt(lastId) + 1;
      localStorage.setItem("lastFormId", nextId);
      return nextId;
    }

    document.getElementById("shiftForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥
      if (submitBtn.disabled) return;

      setCurrentTime();

      const formData = new FormData(e.target);
      formData.set("id", getNextID());
      const data = Object.fromEntries(formData.entries());

      // üîí ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
      submitBtn.disabled = true;
      submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";

      try {
        await fetch(
          "https://script.google.com/macros/s/AKfycbx2Ddy8q-yXB2mdAzsH1fHM30Ylr36zt1F1JkvdcBo_S6vD8v45Loon0RFZzP0IdV38/exec",
          {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify(data),
          }
        );

        Swal.fire({
          icon: "success",
          title: "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß üôè",
          showConfirmButton: false,
          timer: 2000,
        });

        e.target.reset();
        setCurrentTime();
        idField.value = getNextID(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ID
      } catch (error) {
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
        });
      } finally {
        // üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
        submitBtn.disabled = false;
        submitBtn.innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    });

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    setCurrentTime();
    idField.value = getNextID();
  </script>
</body>
</html>


